<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1' name='viewport'>
    <title>Validating your Local Storage Data</title>
    <link href="../assets/style/application.css" rel="stylesheet" />
  </head>
  <body class='notes notes_programming-web'>
    <div id='wrapper'>
      <header id='main_header'>
        <div id='main_header--content'>
          <nav id='main_nav'>
            <h1 id='main_header--title'>
              <a href='/'>Federico Weber</a>
            </h1>
            <ol>
              <li>
                <a href='/work'>work</a>
              </li>
              <li>
                <a class='-active' href='/notes'>notes</a>
              </li>
              <li>
                <a href='/library'>reading</a>
              </li>
              <li>
                <a href='/hire_me'>hire me</a>
              </li>
            </ol>
            <div id='main_nav--marker'></div>
          </nav>
        </div>
      </header>
      <div id='main_content'>
        <p>Local storage is a powerfull tool to cache data computed by web apps for later reuse or non critical persistency<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>. For example I do used it on a recent project, to reduce both the data loaded from the server and the computational cost of sorting a huge list of articles by filters.</p>
        
        <p>Cause the local storage will persiste on the browser for a long time to safely use this data we have to be sure that they are reliable and up to date. Usually the data can get useless for two main reasons: they are based on data produce by the server, that has been updated; or they have been stored by a previous version of the web app which data model have long changed.</p>
        
        <h2 id="getting-the-timestamp">Getting the timestamp</h2>
        <p>To check the data against the server a good option is to have it provide a timestamp<sup id="fnref:2"><a href="#fn:2" class="footnote">2</a></sup> for the latest time the data have been changed.</p>
        
        <p>If the web page, is rendered by the same server we are getting the data from, we can pass this information around as a <strong>Custom data attributes</strong> in the DOM element that hold the app.</p>
        
        <pre><code>&lt;div id="appHolder" data-timestamp="2012-10-02T20:17:08.780Z"&gt;&lt;/div&gt;
        </code></pre>
        
        <p>Otherwise, if the data are coming from a different server, we can get the information as a lightweight JSON.</p>
        
        <pre><code>{
        	"updated": "2012-10-02T18:30:30.179Z"
        }
        </code></pre>
        
        <h2 id="versioning-your-web-app">Versioning your web app</h2>
        <p>To match the data against an updated version of your app the best option is to have a the version number as constant in your app namespace, and save it with your data on the Local Storage.</p>
        
        <pre><code>myApp = {}
        myApp.VERSION = "0.0.4"
        </code></pre>
        
        <h2 id="wrapping-it-up">Wrapping it up</h2>
        <p>It's best to run this test as soon as the app is inited, if both of this test succeed you are usually safe to trust the stored data, otherwise it's reccomended to recreate it.</p>
        
        <hr />
        
        <p>I hope you found this useful if you have questions or comments feel free to contact me on <a href="http://twitter.com/FedericoWeber">Twitter</a> or <a href="https://alpha.app.net/federicoweber">ADN</a>.</p>
        
        <div class="footnotes">
          <ol>
            <li id="fn:1">
              <p>With non critical persistency I intend any kind of data that can be reconstructed without causing damages or requiring serius effort from the end user. Like a precompiled set of filters for a search. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
            </li>
            <li id="fn:2">
              <p>Although not mandatory I reccomend you to store this data in the ISO format <em>"2012-10-02T20:17:08.780Z"</em> to better reuse it in javascript passing it as an argument of a new Date object. <a href="#fnref:2" class="reversefootnote">&#8617;</a></p>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script><script src="../assets/js/application.js"></script>
  </body>
</html>
